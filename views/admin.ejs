<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <%- include('./partials/side.ejs') %>
  <% if(activePage==='Overview'){ %>
 <main>
     <h1>Admin Dashboard</h1>
  <p>Welcome, Admin <%= user.username %>!
</p>
 <div class="stats">
    <h1>Overview</h1>
    <div class="overview">
      <div class="divs seller-over">
        <h2>total user</h2>
        <div class="charts">
          <svg class="sico" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M399 384.2C376.9 345.8 335.4 320 288 320l-64 0c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 16a72 72 0 1 0 0-144 72 72 0 1 0 0 144z"/></svg>
          <div class="digits">
            0
          </div>
        </div>        
      </div>
      <div class="divs seller-over">
        <h2>total products</h2>
        <div class="charts">
          <svg class="sico" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="m400-570 80-40 80 40v-190H400v190ZM280-280v-80h200v80H280Zm-80 160q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-640v560-560Zm0 560h560v-560H640v320l-160-80-160 80v-320H200v560Z"/></svg>
          <div class="digits">
            0
          </div>
        </div>
      </div>
    </div>
    <div class="ad calcs">
      <div class="accs">
        <div class="utils">
          <div class="divs util seller-over">
            <h2>Reported users</h2>
            <div class="stuff">
              <svg class="sico" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M791-55 686-160H160v-112q0-34 17.5-62.5T224-378q45-23 91.5-37t94.5-21L55-791l57-57 736 736-57 57ZM240-240h366L486-360h-6q-56 0-111 13.5T260-306q-9 5-14.5 14t-5.5 20v32Zm496-138q29 14 46 42.5t18 61.5L666-408q18 7 35.5 14t34.5 16ZM568-506l-59-59q23-9 37-29.5t14-45.5q0-33-23.5-56.5T480-720q-25 0-45.5 14T405-669l-59-59q23-34 58-53t76-19q66 0 113 47t47 113q0 41-19 76t-53 58Zm38 266H240h366ZM457-617Z"/></svg>
              <div class="digits">
            0
          </div>
         </div>
          </div>
          <div class="divs util seller-over">
            <h2>Reported products</h2>
            <div class="stuff">
              <svg class="sico" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="m819-28-59-59q-10 3-19.5 5T720-80H240q-50 0-85-35t-35-85v-120h120v-287L27-820l57-57L876-85l-57 57ZM240-160h447l-80-80H200v40q0 17 11.5 28.5T240-160Zm600-73-80-80v-447H313l-73-73v-47l60 60 60-60 60 60 60-60 60 60 60-60 60 60 60-60 60 60 60-60v647Zm-520-87h207L320-527v207Zm155-280-80-80h205v80H475Zm120 120-80-80h85v80h-5Zm85 0q-17 0-28.5-11.5T640-520q0-17 11.5-28.5T680-560q17 0 28.5 11.5T720-520q0 17-11.5 28.5T680-480Zm0-120q-17 0-28.5-11.5T640-640q0-17 11.5-28.5T680-680q17 0 28.5 11.5T720-640q0 17-11.5 28.5T680-600ZM200-160v-80 80Z"/></svg>
              <div class="digits">
            0
          </div>
            </div>
          </div>
        </div>
       <div class="utils">
          <div class="divs util">
            <h2>Manage users</h2>
            <div class="stuff">
              <svg class="sio" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M400-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM80-160v-112q0-33 17-62t47-44q51-26 115-44t141-18h14q6 0 12 2-8 18-13.5 37.5T404-360h-4q-71 0-127.5 18T180-306q-9 5-14.5 14t-5.5 20v32h252q6 21 16 41.5t22 38.5H80Zm560 40-12-60q-12-5-22.5-10.5T584-204l-58 18-40-68 46-40q-2-14-2-26t2-26l-46-40 40-68 58 18q11-8 21.5-13.5T628-460l12-60h80l12 60q12 5 22.5 11t21.5 15l58-20 40 70-46 40q2 12 2 25t-2 25l46 40-40 68-58-18q-11 8-21.5 13.5T732-180l-12 60h-80Zm40-120q33 0 56.5-23.5T760-320q0-33-23.5-56.5T680-400q-33 0-56.5 23.5T600-320q0 33 23.5 56.5T680-240ZM400-560q33 0 56.5-23.5T480-640q0-33-23.5-56.5T400-720q-33 0-56.5 23.5T320-640q0 33 23.5 56.5T400-560Zm0-80Zm12 400Z"/></svg>
            </div>
          </div>
          <div class="divs util">
            <h2>Manage products</h2>
            <div class="stuff">
              <?xml version="1.0" encoding="UTF-8"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg class="sio" width="800px" height="800px" viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>product-management</title>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="ico" fill="#000000" transform="translate(42.666667, 34.346667)">
            <path d="M426.247658,366.986259 C426.477599,368.072636 426.613335,369.17172 426.653805,370.281095 L426.666667,370.986667 L426.666667,392.32 C426.666667,415.884149 383.686003,434.986667 330.666667,434.986667 C278.177524,434.986667 235.527284,416.264289 234.679528,393.025571 L234.666667,392.32 L234.666667,370.986667 L234.679528,370.281095 C234.719905,369.174279 234.855108,368.077708 235.081684,366.992917 C240.961696,371.41162 248.119437,375.487081 256.413327,378.976167 C275.772109,387.120048 301.875889,392.32 330.666667,392.32 C360.599038,392.32 387.623237,386.691188 407.213205,377.984536 C414.535528,374.73017 420.909655,371.002541 426.247658,366.986259 Z M192,7.10542736e-15 L384,106.666667 L384.001134,185.388691 C368.274441,181.351277 350.081492,178.986667 330.666667,178.986667 C301.427978,178.986667 274.9627,184.361969 255.43909,193.039129 C228.705759,204.92061 215.096345,223.091357 213.375754,241.480019 L213.327253,242.037312 L213.449,414.75 L192,426.666667 L-2.13162821e-14,320 L-2.13162821e-14,106.666667 L192,7.10542736e-15 Z M426.247658,302.986259 C426.477599,304.072636 426.613335,305.17172 426.653805,306.281095 L426.666667,306.986667 L426.666667,328.32 C426.666667,351.884149 383.686003,370.986667 330.666667,370.986667 C278.177524,370.986667 235.527284,352.264289 234.679528,329.025571 L234.666667,328.32 L234.666667,306.986667 L234.679528,306.281095 C234.719905,305.174279 234.855108,304.077708 235.081684,302.992917 C240.961696,307.41162 248.119437,311.487081 256.413327,314.976167 C275.772109,323.120048 301.875889,328.32 330.666667,328.32 C360.599038,328.32 387.623237,322.691188 407.213205,313.984536 C414.535528,310.73017 420.909655,307.002541 426.247658,302.986259 Z M127.999,199.108 L128,343.706 L170.666667,367.410315 L170.666667,222.811016 L127.999,199.108 Z M42.6666667,151.701991 L42.6666667,296.296296 L85.333,320.001 L85.333,175.405 L42.6666667,151.701991 Z M330.666667,200.32 C383.155809,200.32 425.80605,219.042377 426.653805,242.281095 L426.666667,242.986667 L426.666667,264.32 C426.666667,287.884149 383.686003,306.986667 330.666667,306.986667 C278.177524,306.986667 235.527284,288.264289 234.679528,265.025571 L234.666667,264.32 L234.666667,242.986667 L234.808715,240.645666 C237.543198,218.170241 279.414642,200.32 330.666667,200.32 Z M275.991,94.069 L150.412,164.155 L192,187.259259 L317.866667,117.333333 L275.991,94.069 Z M192,47.4074074 L66.1333333,117.333333 L107.795,140.479 L233.373,70.393 L192,47.4074074 Z" id="Combined-Shape">

</path>
        </g>
    </g>
</svg>
            </div>
           </div>
        </div>
      </div>
      <div class="chartads">
      <div class="divs chart flex-2">
          <h2>user chart</h2>
          <div class="charts">
           
            <canvas id="userChart">
            </canvas>
          </div>
        </div>
      <div class="divs chart flex-2">
        <h2>Top products</h2>
        <div class="charts">
          <canvas id="pChart"> </canvas>
        </div>
      </div>
    </div>
    </div>
      <section >
    <h2 class="divs">All Users
      <svg class="icor" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z"/></svg>
    </h2>
    <div class="table divs no-p">
    <table id="usersTable" border="1">
      <thead>
        <tr class="topTr">
          <th class="firstt">ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th class="lastt">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (userData) { %>
         <% userData.forEach(user => { %>
          <tr>
            <td class="firstt"><%= user._id %> </td>
            <td><%= user.username %> </td>
            <td><%= user.email %> </td>
            <td><%= user.role %> </td>
            <td><%=user.ad_status || 'active'%></td>
            <td class="lastt">
               <button class="mlist" onclick="location.href='/admin/user/<%= user._id%>'">
              <svg class="more" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M440-120v-240h80v80h320v80H520v80h-80Zm-320-80v-80h240v80H120Zm160-160v-80H120v-80h160v-80h80v240h-80Zm160-80v-80h400v80H440Zm160-160v-240h80v80h160v80H680v80h-80Zm-480-80v-80h400v80H120Z"/></svg>
              </button>
             <button class="dlist usr" data-id="<%= user._id %> ">
             <svg class="more" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>
              </button> </td>
          </tr>
         <% }) %>
        <% } %>
      </tbody>
    </table>
    </div>
  </section> 
     <section >
    <h2 class="divs">All products
      <svg class="icor" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M440-183v-274L200-596v274l240 139Zm80 0 240-139v-274L520-457v274Zm-80 92L160-252q-19-11-29.5-29T120-321v-318q0-22 10.5-40t29.5-29l280-161q19-11 40-11t40 11l280 161q19 11 29.5 29t10.5 40v318q0 22-10.5 40T800-252L520-91q-19 11-40 11t-40-11Zm200-528 77-44-237-137-78 45 238 136Zm-160 93 78-45-237-137-78 45 237 137Z"/></svg>
    </h2>
    <div class="table divs no-p">
    <table id="usersTable" border="1">
      <thead>
        <tr>
          <th class="firstt">ID</th>
          <th>Name</th>
          <th>type</th>
          <th>Seller id</th>
          <th class="lastt">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (productData) { %>
         <% productData.forEach(product => { %>
          <tr>
            <td class="firstt"><%= product._id %> </td>
            <td><%= product.name %> </td>
            <td><%= product.type %> </td>
            <td><%= product.sellerId %> </td>
            <td class="lastt"> <button class="mlist" onclick="location.href='/admin/products/<%= product._id%>'">
              <svg class="more" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M440-120v-240h80v80h320v80H520v80h-80Zm-320-80v-80h240v80H120Zm160-160v-80H120v-80h160v-80h80v240h-80Zm160-80v-80h400v80H440Zm160-160v-240h80v80h160v80H680v80h-80Zm-480-80v-80h400v80H120Z"/></svg>
              </button>
             <button class="dlist prd" data-id="<%= product._id %> ">
             <svg class="more" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>
              </button> </td>
          </tr>
         <% }) %>
        <% } %>
      </tbody>
    </table>
    </div>
  </section>
   <script>
   
     const chartLabels = JSON.parse('<%- JSON.stringify(admUL)%>')
      console.log(chartLabels);
const chartData =  JSON.parse('<%- JSON.stringify(admUData)%>')
const chartLabels2 =  JSON.parse('<%- JSON.stringify(admOL)%>')
const chartData2 =  JSON.parse('<%- JSON.stringify(admOData)%>')
</script>
  </main>
  <% } else if(activePage==='Manageusers'){ %>
    <%- include('./dash_parts/M_user.ejs') %>
   <% } else if(activePage==='Manageproducts'){ %>
    <%- include('./dash_parts/M_products') %>
   <% } else if(activePage==='history'){ %>
    <%- include('./dash_parts/history') %>
   <% } else if(activePage==='Settings'){ %>
    <%- include('./dash_parts/settings') %>  
  <% } %>
  
  <%- include('./partials/popup') %>
   <script src="/chartjs/chart.umd.js"></script>
  <script src="js/adchart.js"></script>
  
  <script>

const deleter = document.querySelectorAll('.dlist.usr');
const deletr = document.querySelectorAll('.dlist.prd');
const pop = document.getElementById('pop');

 deleter.forEach( dlt=>{ 
   const deleteId= dlt.dataset.id
  dlt.addEventListener('click', async ()=>{
    console.log('clicked');
    
 confirm('are you sure ?') 
   const res = await fetch(`/admin/user/${deleteId}`, {
    method:'DELETE'
   }
 )
   if(res.ok){ 
  showus('deleted successfully')
  location.reload()
  }  else{
    console.log(Error)
  }
  }
)})
deletr.forEach( dlt=>{ 
   const deleteId= dlt.dataset.id
  dlt.addEventListener('click', async ()=>{
    console.log('clicked');
    
 confirm('are you sure ?') 
   const res = await fetch(`/product/${deleteId}`, {
    method:'DELETE'
   }
 )
   if(res.ok){ 
  showus('deleted successfully')
  location.reload()
  }  else{
    console.log(Error)
  }
  }
)})

  </script>
</body>
</html>
